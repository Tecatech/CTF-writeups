Implement OTR communication over XMPP in C to talk to the bot. Get our user trusted using socialist millionaire using snprintf OOB null byte write bug to zero secret nonce. Use b64 overflow bug to leak uninitialized stack data, including stack, libc, and canary. Use same overflow to write a ropchain to mprotect the stack and jump to shellcode. Write shellcode to open, read, and send flag over XMPP as a message. Shellcode and ropchain also has to return gracefully, so use the top part of the stack and keep ropchain short to not clobber the stack frame.
